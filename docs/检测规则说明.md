# 检测规则说明

## 1 规则体系设计说明

在系统第一阶段实现过程中，检测规则设计以清晰性、可实现性和可扩展性为主要目标。  
系统整体采用分层规则设计思想，将日志处理过程划分为两个逻辑层面：

第一，日志解析规则，用于对原始日志内容进行识别和结构化处理；  
第二，行为检测规则，用于基于解析结果对潜在攻击行为进行判断。

通过该设计方式，可以在不影响现有功能的前提下，逐步扩展新的日志类型和检测规则。

## 2 日志解析规则设计

### 2.1 设计目的

系统接收到的日志数据大多为非结构化文本，直接用于攻击行为分析存在一定困难。  
日志解析规则的作用是从原始日志中提取安全相关的关键信息，将日志转换为结构化事件数据，为后续检测规则提供统一的数据输入形式。

### 2.2 SSH 登录失败日志解析规则

在当前阶段实现中，系统以 SSH 服务日志作为主要分析对象。  
典型的 SSH 登录失败日志内容如下所示：

> Failed password for invalid user root from 192.168.1.10 port 22 ssh2

系统通过字符串匹配与正则规则，对日志内容进行解析，提取攻击行为相关信息，例如来源地址、尝试登录的用户名以及目标端口等。

### 2.3 解析字段说明

日志解析完成后，系统生成对应的结构化事件数据，主要包含以下字段：

字段包括事件类型、日志来源 IP 地址、尝试登录的用户名、目标端口、原始日志内容以及日志产生时间。  
这些字段将作为后续行为检测规则的基础输入数据。

## 3 行为检测规则设计

### 3.1 设计思路

单条日志通常不足以准确判断攻击行为，因此在第一阶段实现中，系统采用基于时间窗口的行为统计方式，对多条日志事件进行关联分析。

行为检测规则关注的是一定时间范围内的整体访问行为特征，而非单条日志本身。

### 3.2 SSH 暴力破解行为检测规则

SSH 暴力破解攻击通常表现为同一来源 IP 在短时间内多次出现登录失败行为，并尝试使用不同或常见用户名进行登录。

系统在当前阶段通过对上述行为特征进行统计分析，对 SSH 暴力破解行为进行初步识别。

### 3.3 判定条件描述

当系统检测到同一 IP 地址在设定时间窗口内多次出现 SSH 登录失败行为，并且失败次数达到预设阈值时，判定为一次异常登录行为。

当前阶段中，时间窗口大小和失败次数阈值采用固定配置，后续可根据实际需求进行调整和优化。

## 4 规则执行流程说明

系统当前阶段的检测规则执行流程如下：

系统接收原始日志数据后，首先进行日志解析，生成结构化事件数据；  
随后将事件数据送入行为检测模块，在时间窗口内进行统计分析；  
当满足检测条件时，生成对应的告警信息，并用于前端展示和后续处理。

## 5 后续扩展设计说明

当前检测规则体系为系统的第一阶段实现，后续可在此基础上继续扩展其他服务日志解析规则，增加多条件组合检测规则，并逐步引入规则配置化和行为关联分析机制。
